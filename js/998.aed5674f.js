"use strict";(self["webpackChunkyour_project"]=self["webpackChunkyour_project"]||[]).push([[998],{18998:(e,t,a)=>{a.r(t),a.d(t,{default:()=>z});var u=a(81587),n=a(14048),l=a(30388),r=(a(16280),a(76918),a(28706),a(23288),a(2892),a(9868),a(26099),a(78459),a(58940),a(27495),a(90906),a(38781),a(47764),a(71761),a(62953),a(56768)),s=a(24232),v=a(45130),o=a(90144),i=a(81387),c=a(23330),p=a(50876),d={class:"pool-detail"},f={class:"header"},h={class:"title"},k={class:"pool-info"},m={class:"card"},b={class:"user-balances"},x={class:"reserves"},L={class:"user-liquidity"},w={key:0,class:"approval-card"},y=["disabled"],_={class:"swap-section card"},I={class:"input-group"},A={class:"direction-select"},R={class:"swap-output"},g=["disabled"],K={key:0},W={key:1},C={class:"liquidity-management"},F={class:"add-liquidity card"},E={key:0,class:"ratio-notice"},U={class:"input-group"},N=["placeholder"],S={key:0,class:"auto-calculate-tip"},T=["placeholder"],P=["disabled"],q={key:0},X={key:1},j={class:"remove-liquidity card"},B={class:"input-group"},O={class:"liquidity-preview"},D=["disabled"],M={key:0},Q={key:1},V={key:1,class:"error-card"};const J={__name:"PoolDetail",setup:function(e){var t=(0,i.lq)(),a=(0,c.It)(),J=(0,o.KR)(t.params.poolId),Y=(0,o.KR)(""),$=(0,o.KR)(""),z=(0,o.KR)("0"),G=(0,o.KR)("0"),H=(0,o.KR)(""),Z=(0,o.KR)(""),ee=(0,o.KR)("0"),te=(0,o.KR)("0"),ae=(0,o.KR)("0"),ue=(0,o.KR)(!0),ne=(0,o.KR)(""),le=(0,o.KR)(!1),re=(0,r.EW)((function(){return ne.value>0})),se=(0,o.KR)(!1),ve=(0,o.KR)(""),oe=(0,o.KR)(""),ie=(0,o.KR)(""),ce=(0,o.KR)(""),pe=(0,o.KR)(!1),de=(0,o.KR)(!1),fe=(0,o.KR)(""),he=(0,o.KR)(!0),ke=(0,o.KR)(""),me=(0,o.KR)(0),be=(0,o.KR)(0),xe=(0,o.KR)("0"),Le=(0,o.KR)("0"),we=(0,o.KR)("0"),ye=(0,r.EW)((function(){return ke.value>0&&Number(ke.value)<=Number(ee.value)})),_e=function(){if(xe.value&&0!==xe.value){var e=ke.value/xe.value;me.value=ge((z.value+Le.value)*e),be.value=ge((G.value+we.value)*e)}},Ie=(0,o.KR)(null),Ae=function(e,t){return z.value&&G.value?0===t?e*(G.value/z.value):e*(z.value/G.value):0};(0,r.wB)(ie,(function(e){if(1!==Ie.value&&""!==e){Ie.value=0;var t=Ae(e,0).toFixed(4);ce.value=isNaN(t)?"":t}})),(0,r.wB)(ce,(function(e){if(0!==Ie.value&&""!==e){Ie.value=1;var t=Ae(e,1).toFixed(4);ie.value=isNaN(t)?"":t}}));var Re=function(e){var t=e.target.value;(""===t||/^[0-9]*\.?[0-9]*$/.test(t))&&(ne.value=t)};function ge(e){var t=Number(e);return isNaN(t)?"0":t.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:4})}function Ke(){return We.apply(this,arguments)}function We(){return We=(0,l.A)((0,n.A)().mark((function e(){var t,u,l,r,s;return(0,n.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,c.sU)();case 3:return t=e.sent,u=[(0,p.Fj)(Y.value),(0,p.Fj)($.value)],l=u[0],r=u[1],e.next=7,Promise.all([l.methods.balanceOf(t).call(),r.methods.balanceOf(t).call()]);case 7:s=e.sent,te.value=a.utils.fromWei(s[0],"ether"),ae.value=a.utils.fromWei(s[1],"ether"),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](0),console.error("余额加载失败:",e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])}))),We.apply(this,arguments)}function Ce(){return Fe.apply(this,arguments)}function Fe(){return Fe=(0,l.A)((0,n.A)().mark((function e(){var t,l,r,s,v,o,i,d,f,h,k,m,b,x,L,w,y,_,I,A,R,g,K;return(0,n.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,a){e.next=4;break}return e.next=4,(0,c.Cs)(!1);case 4:return t=(0,p.Wt)(),e.next=7,(0,c.sU)();case 7:return l=e.sent,e.next=10,t.methods.getPoolInfo(J.value).call();case 10:return r=e.sent,s=r.token0,v=r.token1,o=r.info,i=o.reserve0,d=o.reserve1,f=o.fee0,h=o.fee1,k=o.totalSupply,Y.value=s,$.value=v,z.value=a.utils.fromWei(i,"ether"),G.value=a.utils.fromWei(d,"ether"),Le.value=a.utils.fromWei(f,"ether"),we.value=a.utils.fromWei(h,"ether"),xe.value=a.utils.fromWei(k,"ether"),m=[(0,p.Fj)(s),(0,p.Fj)(v)],b=m[0],x=m[1],e.next=22,Promise.all([b.methods.symbol().call(),x.methods.symbol().call()]);case 22:return L=e.sent,w=(0,u.A)(L,2),y=w[0],_=w[1],H.value=y,Z.value=_,e.next=30,Promise.all([t.methods.getUserLiquidity(J.value,l).call(),b.methods.balanceOf(l).call(),x.methods.balanceOf(l).call()]);case 30:I=e.sent,A=(0,u.A)(I,3),R=A[0],g=A[1],K=A[2],ee.value=a.utils.fromWei(R,"ether"),te.value=a.utils.fromWei(g,"ether"),ae.value=a.utils.fromWei(K,"ether"),e.next=44;break;case 40:e.prev=40,e.t0=e["catch"](0),console.error("池数据加载失败:",e.t0),fe.value="加载失败: ".concat(e.t0.message);case 44:case"end":return e.stop()}}),e,null,[[0,40]])}))),Fe.apply(this,arguments)}function Ee(e,t){return Ue.apply(this,arguments)}function Ue(){return Ue=(0,l.A)((0,n.A)().mark((function e(t,a){var u,l,r;return(0,n.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,c.sU)();case 2:return u=e.sent,l=(0,p.Fj)(t),e.next=6,l.methods.allowance(u,(0,p.Wt)().options.address).call();case 6:if(r=e.sent,!(BigInt(r)<BigInt(a))){e.next=11;break}return ve.value=t,oe.value=t===Y.value?H.value:Z.value,e.abrupt("return",!1);case 11:return e.abrupt("return",!0);case 12:case"end":return e.stop()}}),e)}))),Ue.apply(this,arguments)}function Ne(){return Se.apply(this,arguments)}function Se(){return Se=(0,l.A)((0,n.A)().mark((function e(){var t,u;return(0,n.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,se.value=!0,t=(0,p.Fj)(ve.value),u=a.utils.toTwosComplement(-1),e.t0=t.methods.approve((0,p.Wt)().options.address,u),e.next=7,(0,c.sU)();case 7:return e.t1=e.sent,e.t2={from:e.t1},e.next=11,e.t0.send.call(e.t0,e.t2);case 11:return ve.value="",e.next=14,Ke();case 14:e.next=19;break;case 16:e.prev=16,e.t3=e["catch"](0),De(e.t3,"授权失败");case 19:return e.prev=19,se.value=!1,e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[0,16,19,22]])}))),Se.apply(this,arguments)}function Te(){return Pe.apply(this,arguments)}function Pe(){return Pe=(0,l.A)((0,n.A)().mark((function e(){var t,u,l,r,s;return(0,n.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,le.value=!0,fe.value="",t=parseFloat(ne.value),!(t<1)){e.next=6;break}throw new Error("最小兑换量为1");case 6:return u=a.utils.toWei(ne.value,"ether"),l=ue.value?Y.value:$.value,e.next=10,Ee(l,u);case 10:if(e.sent){e.next=12;break}return e.abrupt("return");case 12:return r=(0,p.Wt)(),s=.9*je.value,e.t1=r.methods,e.t2=J.value,e.t3=u,e.t4=a.utils.toWei(s.toFixed(18),"ether"),e.t5=ue.value,e.next=21,(0,c.sU)();case 21:return e.t6=e.sent,e.t0=e.t1.swap.call(e.t1,e.t2,e.t3,e.t4,e.t5,e.t6),e.next=25,(0,c.sU)();case 25:return e.t7=e.sent,e.t8={from:e.t7},e.next=29,e.t0.send.call(e.t0,e.t8);case 29:return e.next=31,Promise.all([Ce(),Ke()]);case 31:ne.value="",e.next=37;break;case 34:e.prev=34,e.t9=e["catch"](0),De(e.t9,"兑换失败");case 37:return e.prev=37,le.value=!1,e.finish(37);case 40:case"end":return e.stop()}}),e,null,[[0,34,37,40]])}))),Pe.apply(this,arguments)}function qe(){return Xe.apply(this,arguments)}function Xe(){return Xe=(0,l.A)((0,n.A)().mark((function e(){var t,l,r,s,v,o,i,d,f,h,k,m,b;return(0,n.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,pe.value=!0,fe.value="",t=(0,p.Wt)(),e.next=6,(0,c.sU)();case 6:if(l=e.sent,console.log(ie.value,te.value,"比大小"),!(!ie.value||!ce.value||Number(ie.value)<=0||Number(ce.value)<=0)){e.next=10;break}throw new Error("请输入有效的代币数量");case 10:if(!(ie.value>te.value)){e.next=12;break}throw new Error("".concat(H.value," 余额不足"));case 12:if(!(ce.value>ae.value)){e.next=14;break}throw new Error("".concat(Z.value," 余额不足"));case 14:if(r=G.value/z.value,s=ce.value/ie.value,!(Math.abs(s-r)>.01*r)){e.next=18;break}throw new Error("比例需保持 ".concat(z.value," : ").concat(G.value," (±1%)"));case 18:return v=[(0,p.Fj)(Y.value),(0,p.Fj)($.value)],o=v[0],i=v[1],e.next=21,Promise.all([o.methods.decimals().call(),i.methods.decimals().call()]);case 21:return d=e.sent,f=(0,u.A)(d,2),h=f[0],k=f[1],m=BigInt(a.utils.toWei(ie.value,"ether"))/BigInt(Math.pow(10,18-parseInt(h))),b=BigInt(a.utils.toWei(ce.value,"ether"))/BigInt(Math.pow(10,18-parseInt(k))),console.log(3),e.next=30,Promise.all([o.methods.approve(t.options.address,m.toString()).send({from:l}),i.methods.approve(t.options.address,b.toString()).send({from:l})]);case 30:return e.next=32,t.methods.addLiquidity(J.value,m.toString(),b.toString(),95n*m/100n,95n*b/100n).send({from:l});case 32:return ie.value="",ce.value="",e.next=36,Ce();case 36:e.next=41;break;case 38:e.prev=38,e.t0=e["catch"](0),De(e.t0,"添加流动性失败");case 41:return e.prev=41,pe.value=!1,e.finish(41);case 44:case"end":return e.stop()}}),e,null,[[0,38,41,44]])}))),Xe.apply(this,arguments)}var je=(0,r.EW)((function(){if(!ne.value||ne.value<=0)return"0";var e=ue.value?z.value:G.value,t=ue.value?G.value:z.value;if(e<=0||t<=0)return"0";var a=parseFloat(ne.value),u=997*a,n=u*t,l=1e3*e+u;return(n/l).toFixed(4)}));function Be(){return Oe.apply(this,arguments)}function Oe(){return Oe=(0,l.A)((0,n.A)().mark((function e(){var t,u;return(0,n.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,de.value=!0,t=(0,p.Wt)(),u=a.utils.toWei(ke.value.toString(),"ether"),e.t0=t.methods.removeLiquidity(J.value,u),e.next=7,(0,c.sU)();case 7:return e.t1=e.sent,e.t2={from:e.t1},e.next=11,e.t0.send.call(e.t0,e.t2);case 11:return ke.value="",me.value=0,be.value=0,e.next=16,Ce();case 16:return e.next=18,Ke();case 18:e.next=23;break;case 20:e.prev=20,e.t3=e["catch"](0),De(e.t3,"移除失败");case 23:return e.prev=23,de.value=!1,e.finish(23);case 26:case"end":return e.stop()}}),e,null,[[0,20,23,26]])}))),Oe.apply(this,arguments)}function De(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"操作失败",u={INSUFFICIENT_OUTPUT_AMOUNT:"输出数量不足，请调整滑点",INSUFFICIENT_LIQUIDITY_BURNED:"流动性不足",INSUFFICIENT_A_AMOUNT:"".concat(H.value," 数量不足"),INSUFFICIENT_B_AMOUNT:"".concat(Z.value," 数量不足"),INITIAL_DEPOSIT_REQUIRED:"必须提供初始流动性"},n=(null===(t=e.message.match(/reverted with reason string '(.*)'/))||void 0===t?void 0:t[1])||e.message;fe.value="".concat(a,": ").concat(u[n]||n)}function Me(){var e=(0,p.Wt)(),t=function(){return Ce()};e.events.Swapped({poolId:J.value}).on("data",t),e.events.LiquidityAdded({poolId:J.value}).on("data",t),e.events.LiquidityRemoved({poolId:J.value}).on("data",t)}return(0,r.sV)((0,l.A)((0,n.A)().mark((function e(){var t;return(0,n.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,c.sU)();case 2:if(t=e.sent,!t){e.next=7;break}return e.next=6,Ce();case 6:Me();case 7:case"end":return e.stop()}}),e)})))),function(e,t){var a=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",d,[(0,r.Lk)("div",f,[(0,r.bF)(a,{to:"/",class:"back-btn"},{default:(0,r.k6)((function(){return t[9]||(t[9]=[(0,r.eW)(" < 返回列表 ")])})),_:1}),(0,r.Lk)("h1",h,(0,s.v_)(H.value)+"/"+(0,s.v_)(Z.value)+" 交易池 ",1)]),(0,r.Lk)("div",k,[(0,r.Lk)("div",m,[t[10]||(t[10]=(0,r.Lk)("h3",null,"账户余额",-1)),(0,r.Lk)("div",b,[(0,r.Lk)("p",null,(0,s.v_)(H.value)+" 余额: "+(0,s.v_)(ge(te.value)),1),(0,r.Lk)("p",null,(0,s.v_)(Z.value)+" 余额: "+(0,s.v_)(ge(ae.value)),1)]),t[11]||(t[11]=(0,r.Lk)("h3",null,"流动性信息",-1)),(0,r.Lk)("div",x,[(0,r.Lk)("p",null,(0,s.v_)(H.value)+" 储备量: "+(0,s.v_)(ge(z.value)),1),(0,r.Lk)("p",null,(0,s.v_)(Z.value)+" 储备量: "+(0,s.v_)(ge(G.value)),1)]),(0,r.Lk)("div",L,[(0,r.Lk)("p",null,"您的流动性: "+(0,s.v_)(ge(ee.value))+" LP",1)])])]),ve.value?((0,r.uX)(),(0,r.CE)("div",w,[(0,r.Lk)("p",null,"需要先授权 "+(0,s.v_)(oe.value)+" 代币",1),(0,r.Lk)("button",{onClick:Ne,disabled:se.value},(0,s.v_)(se.value?"处理中...":"立即授权"),9,y)])):(0,r.Q3)("",!0),(0,r.Lk)("div",_,[t[13]||(t[13]=(0,r.Lk)("h3",null,"代币兑换（3%手续费，90%滑点保护）",-1)),(0,r.Lk)("div",I,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=function(e){return ne.value=e}),type:"number",step:"any",placeholder:"输入兑换数量",onInput:Re},null,544),[[v.Jo,ne.value,void 0,{number:!0}]]),(0,r.Lk)("div",A,[(0,r.Lk)("button",{class:(0,s.C4)({active:ue.value}),onClick:t[1]||(t[1]=function(e){return ue.value=!0})},(0,s.v_)(H.value)+" → "+(0,s.v_)(Z.value),3),(0,r.Lk)("button",{class:(0,s.C4)({active:!ue.value}),onClick:t[2]||(t[2]=function(e){return ue.value=!1})},(0,s.v_)(Z.value)+" → "+(0,s.v_)(H.value),3)])]),(0,r.Lk)("div",R,[t[12]||(t[12]=(0,r.eW)(" 预计获得: ")),(0,r.Lk)("strong",null,(0,s.v_)(je.value),1),(0,r.eW)(" "+(0,s.v_)(e.outputTokenSymbol),1)]),(0,r.Lk)("button",{class:"swap-btn",disabled:!re.value||le.value,onClick:Te},[le.value?((0,r.uX)(),(0,r.CE)("span",K,"交易处理中...")):((0,r.uX)(),(0,r.CE)("span",W,"立即兑换"))],8,g)]),(0,r.Lk)("div",C,[(0,r.Lk)("div",F,[t[14]||(t[14]=(0,r.Lk)("h3",null,"添加流动性",-1)),z.value>0&&G.value>0?((0,r.uX)(),(0,r.CE)("div",E," 当前比例: 1 "+(0,s.v_)(H.value)+" = "+(0,s.v_)((G.value/z.value).toFixed(4))+" "+(0,s.v_)(Z.value),1)):(0,r.Q3)("",!0),(0,r.Lk)("div",U,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=function(e){return ie.value=e}),type:"number",placeholder:"".concat(H.value," 数量"),onFocus:t[4]||(t[4]=function(e){return he.value=!0})},null,40,N),[[v.Jo,ie.value]]),he.value?((0,r.uX)(),(0,r.CE)("div",S," ← 自动计算 → ")):(0,r.Q3)("",!0),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[5]||(t[5]=function(e){return ce.value=e}),type:"number",placeholder:"".concat(Z.value," 数量"),onFocus:t[6]||(t[6]=function(e){return he.value=!1})},null,40,T),[[v.Jo,ce.value]])]),(0,r.Lk)("button",{class:"add-btn",disabled:pe.value,onClick:qe},[pe.value?((0,r.uX)(),(0,r.CE)("span",q,"处理中...")):((0,r.uX)(),(0,r.CE)("span",X,"添加流动性"))],8,P)]),(0,r.Lk)("div",j,[t[15]||(t[15]=(0,r.Lk)("h3",null,"移除流动性",-1)),(0,r.Lk)("div",B,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=function(e){return ke.value=e}),type:"number",step:"any",placeholder:"输入要移除的LP数量",onInput:_e},null,544),[[v.Jo,ke.value,void 0,{number:!0}]]),(0,r.Lk)("div",O," 预计获得： "+(0,s.v_)(me.value)+" "+(0,s.v_)(H.value)+" 和 "+(0,s.v_)(be.value)+" "+(0,s.v_)(Z.value),1)]),(0,r.Lk)("button",{class:"remove-btn",disabled:!ye.value||de.value,onClick:Be},[de.value?((0,r.uX)(),(0,r.CE)("span",M,"处理中...")):((0,r.uX)(),(0,r.CE)("span",Q,"移除流动性"))],8,D)])]),fe.value?((0,r.uX)(),(0,r.CE)("div",V,[(0,r.eW)((0,s.v_)(fe.value)+" ",1),(0,r.Lk)("button",{class:"close-btn",onClick:t[8]||(t[8]=function(e){return fe.value=""})}," × ")])):(0,r.Q3)("",!0)])}}};var Y=a(71241);const $=(0,Y.A)(J,[["__scopeId","data-v-2972c7f7"]]),z=$}}]);
//# sourceMappingURL=998.aed5674f.js.map